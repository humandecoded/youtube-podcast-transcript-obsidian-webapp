{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Background job</h2>
  <p><strong>Job ID:</strong> <code>{{ job_id }}</code></p>
  <p><strong>Status:</strong> {{ status }}</p>

  {% if current_step %}
    <p><strong>Current Step:</strong> {{ current_step }}</p>
  {% endif %}

  {% if logs %}
    <details open>
      <summary><strong>Processing Logs</strong></summary>
      <pre class="code" style="max-height: 400px; overflow-y: auto; background: #1e1e1e; color: #d4d4d4; padding: 10px; border-radius: 4px;">{% for log in logs %}{{ log }}
{% endfor %}</pre>
    </details>
  {% endif %}

  {% if refresh_secs and not error %}
    <p class="muted">Refreshing in {{ refresh_secs }}s‚Ä¶</p>
    <script>
      setTimeout(() => location.reload(), {{ refresh_secs * 1000 }});
    </script>
  {% endif %}

  {% if error %}
    <div class="alert error">Error: {{ error }}</div>
  {% endif %}

  {% if result %}
    {% if result.proxy_used %}
      <p class="muted">üåê Using proxy: <code>{{ result.proxy_used }}</code></p>
    {% endif %}
    
    <h3>{{ 'Metadata' if result.summary.startswith('# Summary\n_(no summary') else 'Summary' }}</h3>
    <pre class="code">{{ result.summary }}</pre>

    {% if result.note_path %}
      <p><strong>Note written to:</strong><br><code>{{ result.note_path }}</code></p>
    {% else %}
      <p class="muted">No vault configured; nothing was written.</p>
    {% endif %}
  {% endif %}

  <p><a class="btn secondary" href="{{ url_for('index') }}">‚Üê Back</a></p>
</div>
{% endblock %}

